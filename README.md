# 🎨 LINE Sticker Batch Processor

一個功能完整的 Streamlit 網站應用程式，用於自動處理 LINE 貼紙表單。該應用程式可以自動分割、去背、裁剪和調整貼紙尺寸，並生成符合 LINE 貼紙規格的 PNG 檔案。

## ✨ 功能特點

- **自動分割** - 根據網格設定將大影像分割成小格子
- **智能去背** - 使用 AI 模型自動移除貼紙背景
- **自動裁剪** - 移除透明邊框，最大化貼紙內容
- **尺寸調整** - 縮放至 LINE 貼紙規格 (最大 370×320px)，使用高品質 LANCZOS 重新採樣
- **批量處理** - 一次性處理整個貼紙表單
- **實時預覽** - 顯示前 12 個處理結果供預覽
- **一鍵下載** - 將所有貼紙打包成 ZIP 檔案

## 📋 系統需求

- Python 3.8+
- 4GB 以上 RAM (用於 rembg 模型)
- 網際網路連線 (首次執行時下載 AI 模型)

## 🚀 安裝與執行

### 1. 克隆或下載專案

```bash
cd /home/ubuntu/line_sticker_processor
```

### 2. 建立虛擬環境 (可選但建議)

```bash
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# 或
venv\Scripts\activate  # Windows
```

### 3. 安裝依賴

```bash
pip install -r requirements.txt
```

### 4. 執行應用程式

```bash
streamlit run app.py
```

應用程式將在瀏覽器中開啟，通常地址為 `http://localhost:8501`

## 📖 使用說明

### 基本步驟

1. **上傳貼紙表單**
   - 點擊「選擇影像檔案」按鈕
   - 選擇包含貼紙表單的 JPG 或 PNG 影像

2. **設定網格參數**
   - 在左側邊欄設定「網格列數」(預設 6)
   - 設定「網格行數」(預設 5)
   - 設定下載檔名 (預設 "Stickers_Done")

3. **開始處理**
   - 點擊「開始處理」按鈕
   - 等待進度條完成 (時間取決於貼紙數量和電腦效能)

4. **預覽結果**
   - 查看前 12 個貼紙的預覽
   - 檢查處理結果是否滿意

5. **下載檔案**
   - 點擊「下載 ZIP 檔案」按鈕
   - 將包含所有貼紙的 ZIP 檔案下載到電腦

### 貼紙表單格式

貼紙表單是一個大影像，其中包含多個貼紙排列成網格。例如：

```
6 列 × 5 行 = 30 個貼紙
4 列 × 4 行 = 16 個貼紙
```

影像尺寸沒有嚴格限制，應用程式會自動根據網格設定進行分割。

## 📏 LINE 貼紙規格

處理後的貼紙符合 LINE 官方規格：

- **最大寬度**: 370 像素
- **最大高度**: 320 像素
- **格式**: PNG (透明背景)
- **檔案命名**: 01.png, 02.png, ..., 30.png (依序編號)

## 🔧 技術細節

### 處理流程

```
原始影像
  ↓
[分割] - 根據網格設定分割成小格子
  ↓
[去背] - 使用 U²-Net 模型移除背景
  ↓
[裁剪] - 自動移除透明邊框
  ↓
[調整大小] - 縮放至 LINE 規格 (LANCZOS 重新採樣)
  ↓
[打包] - 生成 ZIP 檔案
  ↓
下載
```

### 核心模組

- **image_processor.py** - 影像處理邏輯
  - `StickerProcessor` 類別
  - 影像分割、去背、裁剪、調整大小

- **zip_handler.py** - ZIP 檔案生成
  - `create_sticker_zip()` 函數

- **app.py** - Streamlit 使用者介面

### 依賴套件

| 套件 | 版本 | 用途 |
|------|------|------|
| streamlit | 1.28.1 | Web 框架 |
| Pillow | 10.1.0 | 影像處理 |
| rembg | 2.0.50 | 背景移除 |
| onnxruntime | 1.16.3 | AI 模型執行 |
| numpy | 1.24.3 | 數值計算 |

## 🧪 測試

執行測試指令碼驗證應用程式功能：

```bash
python test_app.py
```

測試包括：
- 基本影像處理功能
- 批量處理
- ZIP 檔案建立
- 邊界情況處理

## ⚙️ 進階設定

### 修改 LINE 貼紙規格

編輯 `image_processor.py` 中的 `StickerProcessor` 類別：

```python
class StickerProcessor:
    MAX_WIDTH = 370   # 修改最大寬度
    MAX_HEIGHT = 320  # 修改最大高度
```

### 自訂 UI 樣式

編輯 `app.py` 中的 CSS 樣式部分：

```python
st.markdown("""
<style>
    /* 自訂 CSS */
</style>
""", unsafe_allow_html=True)
```

## 📝 常見問題

### Q: 首次執行為什麼很慢？
A: 首次執行時需要下載 U²-Net AI 模型 (約 176MB)。下載完成後會被快取，後續執行會快得多。

### Q: 如何處理特別大的貼紙表單？
A: 應用程式沒有硬性限制，但處理時間會隨著貼紙數量增加而增加。建議分批處理超大表單。

### Q: 去背效果不理想怎麼辦？
A: 去背效果取決於貼紙的背景對比度。建議：
- 確保貼紙與背景有明確的色彩對比
- 避免複雜的漸層背景
- 如果效果不佳，可以手動編輯後重新上傳

### Q: 支援哪些影像格式？
A: 目前支援 JPG、JPEG 和 PNG 格式。

### Q: 如何批量上傳多個貼紙表單？
A: 目前應用程式一次只能處理一個影像。如需處理多個表單，請重複執行上傳和處理步驟。

## 🐛 故障排除

### 錯誤: ModuleNotFoundError

確保所有依賴已安裝：
```bash
pip install -r requirements.txt
```

### 錯誤: 記憶體不足

rembg 模型需要較多記憶體。如果遇到記憶體不足的錯誤，請：
- 關閉其他應用程式
- 減少同時處理的貼紙數量
- 使用更大記憶體的電腦

### 影像無法上傳

確保：
- 檔案格式為 JPG/JPEG/PNG
- 檔案大小合理 (建議 < 50MB)
- 檔案沒有損壞

## 📄 授權

本專案為開源軟體，可自由使用和修改。

## 🤝 貢獻

歡迎提交 Issue 和 Pull Request！

## 📧 聯絡方式

如有問題或建議，請提交 Issue。

---

**祝您使用愉快！** 🎉
